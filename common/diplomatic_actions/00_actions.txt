# Variables:
#  is_listed, boolean, decides if this diplomactic action type is listed in diplomatic view.
#  prerequisites, list, the technologies required to enable the player to send this diplomatic action.
#  requires_actor_peace, boolean, false by default, will require the actor to be at peace for this action to pass the possible check.
#  requires_alliance_vote, boolean, false by default, will require the alliance of the actor to vote for this action before passing it on to the recipient.
#  requires_actor_independence, boolean, true by default, will require the actor to be independent.
#  requires_recipient_independence, boolean, true by default, will require the recipient to be independent.
#  requires_actor_federation_leader, boolean, false by default, if the actor is in a federation, he has to be the leader of it.
#  requires_recipient_federation_leader, boolean, true by default, if the recipient is in a federation, he has to be the leader of it.
#  show_decline_to_alliance_members, boolean, false by default, will show your alliance members when you decline a proposal of this type.
#  should_show_accept_message, decides whether actor gets a response on acceptance (otherwise just on decline)
#  should_remove_response_message_when_not_possible, boolean, decides if diplomatic response messages should be removed when the 'possible' check fails.
#  should_show_auto_accept_message_recipient, boolean, decides if the recipient gets a message showing the diplomatic action.
#  should_open_auto_accept_message_recipient, boolean, decides if the recipient automatically opens this message.
#  should_notify_auto_recipient_on_vote_fail, boolean, decides if recipient is notified of vote failure if action was auto accepted.
#  should_show_auto_accept_message_actor, boolean, decides if the actor gets a reply showing the diplomatic action.
#  should_notify_all_communications, boolean, decides if a message notification is sent to all countries who have communications with actor or recipient
#  AI_acceptance_base_value, default = 0
#  potential, trigger, root is actor, from is recipient, decides if the action is shown
#  possible, trigger, root is actor, from is recipient, prev is either requester (if action is done in response to an ask_xxx counterpart) or same as root, decides if the action is still possible
#  proposable, trigger, root is actor, from is recipient, decides if the action is proposable
#@cb_subjugation_length = 360
# Create Trade Agreement
action_create_trade_agreement = {
	icon = "GFX_diplomacy_improve_relation"	# REPLACE THIS
	auto_accepted = yes
	requires_actor_independence = no
	requires_recipient_independence = no
	action_type = positive
	potential = {
		hidden_trigger = {
			from = {
				is_major = yes
			}
		}
	}
}

# Improve opinion
action_improve_relation = {
	icon = "GFX_diplomacy_improve_relation"
	auto_accepted = yes
	require_envoy = yes
	envoy_assignment = improve_relations
	requires_actor_independence = no
	requires_recipient_independence = no
	action_type = positive
	potential = {
		hidden_trigger = {
			or = {
				is_country_type = default
				is_country_type = contender
			}
			from = {
				or = {
					is_country_type = default
					is_country_type = contender
				}
				not = { has_ethic = ethic_fanatic_xenophobe }
			}
		}
	}
	possible = {
		custom_tooltip = {
			fail_text = "diplo_action_puppet_state_prevents_opinion_inc"
			NOT = {
				is_at_war_with = from
			}
		}
		# custom_tooltip = {
		# 	fail_text = "requires_actor_not_fanatic_purifiers"
		# 	OR = {
		# 		is_same_species = from
		# 		NOT = { has_valid_civic = civic_fanatic_purifiers	}
		# 	}
		# }
		# custom_tooltip = {
		# 	fail_text = "requires_recipient_not_fanatic_purifiers"
		# 	OR = {
		# 		is_same_species = from
		# 		from = { NOT = { has_valid_civic = civic_fanatic_purifiers } }
		# 	}
		# }
		custom_tooltip = {
			fail_text = "diplo_action_puppet_state_prevents_opinion_inc"
			OR = {
				is_major = no
				from = {
					NOT = {
						is_subject_type = puppet_state
					}
				}
				from = {
					exists = overlord
					overlord = {
						is_same_value = root
					}
				}
			}
		}
	}
	proposable = {
		custom_tooltip = {
			fail_text = "requires_envoy_not_harming_relations"
			NOT = {
				is_harming_relations_with = from
			}
		}
	}
}

# Build Spy Network
action_build_spy_network = {
	icon = "GFX_diplomacy_improve_relation"
	auto_accepted = yes
	require_envoy = yes
	envoy_assignment = spy_network
	requires_actor_independence = no
	requires_recipient_independence = no
	action_type = positive
	potential = {
		always = no
	}
}

# Harm opinion
action_harm_relation = {
	icon = "GFX_diplomacy_harm_relation"
	auto_accepted = yes
	require_envoy = yes
	envoy_assignment = harm_relations
	requires_actor_independence = no
	requires_recipient_independence = no
	action_type = negative
	potential = {
		hidden_trigger = {
			or = {
				is_country_type = default
				is_country_type = contender
			}
			from = {
				or = {
					is_country_type = default
					is_country_type = contender
				}
			}
		}
		hidden_trigger = {
			from = {
				or = {
					is_major = yes
					is_country_type = contender
				}
			}
		}
	}
	possible = {
		custom_tooltip = {
			fail_text = "DIPLOMACY_STATUS_WAR"
			NOT = {
				is_at_war_with = from
			}
		}
		# custom_tooltip = {
		# 	fail_text = "requires_actor_not_fanatic_purifiers"
		# 	OR = {
		# 		is_same_species = from
		# 		NOT = { has_valid_civic = civic_fanatic_purifiers	}
		# 	}
		# }
		# custom_tooltip = {
		# 	fail_text = "requires_recipient_not_fanatic_purifiers"
		# 	OR = {
		# 		is_same_species = from
		# 		from = { NOT = { has_valid_civic = civic_fanatic_purifiers } }
		# 	}
		# }
	}
	proposable = {
		custom_tooltip = {
			fail_text = "requires_envoy_not_improving_relations"
			NOT = {
				is_improving_relations_with = from
			}
		}
	}
}

# Declare war, usable by regular empires
action_declare_war = {
	icon = "GFX_diplomacy_status_war"
	requires_actor_independence = no	# You are able to declare war only on your overlord when being a vassal, this special case is handled in code instead.
	requires_recipient_independence = no
	requires_alliance_vote = yes
	requires_unanimous_vote = yes
	auto_accepted = yes
	should_show_auto_accept_message_actor = yes
	should_show_auto_accept_message_recipient = yes
	should_open_auto_accept_message_recipient = yes
	should_notify_all_communications = yes
	action_type = aggressive
	possible = {
		days_passed >= 3
	}
}

# Make peace, usable by regular, fallen & awakened empires - accessed from war view
action_offer_peace = {
	icon = "GFX_diplomacy_status_truce"
	is_listed = no	# Peace offers are handled through the war overview.
	requires_actor_independence = no
	requires_recipient_independence = no
	should_notify_all_communications = yes
	should_show_accept_message = no
	should_remove_response_message_when_not_possible = yes
	action_type = positive
}

# Dummy action for opening the war overview from the diplomacy view
action_offer_peace_diplomacy_view = {
	is_listed = yes
}

# Dummy action for opening the claims view from the diplomacy view
action_make_claims_diplomacy_view = {
	is_listed = yes
	requires_actor_independence = no
	requires_recipient_independence = no

	possible = {}
	potential = {}
}

# Offer trade deal lets you trade a bunch of stuff. Usable by regular, fallen & awakened empires.
action_offer_trade_deal = {
	icon = "GFX_diplomacy_status_trade"
	requires_recipient_independence = no
	requires_actor_independence = no
	action_type = neutral
	potential = {
		hidden_trigger = {
			from = {
				is_major = yes
			}
		}
	}
	possible = {
		# custom_tooltip = {
		# 	fail_text = "requires_actor_not_fanatic_purifiers"
		# 	OR = {
		# 		is_same_species = from
		# 		NOT = { has_valid_civic = civic_fanatic_purifiers	}
		# 	}
		# }
		# custom_tooltip = {
		# 	fail_text = "requires_recipient_not_fanatic_purifiers"
		# 	OR = {
		# 		is_same_species = from
		# 		from = { NOT = { has_valid_civic = civic_fanatic_purifiers } }
		# 	}
		# }
	}
}

# Currently disabled
action_cancel_trade_deal = {
	icon = "GFX_diplomacy_status_trade"
	requires_recipient_independence = no
	requires_actor_independence = no
	is_listed = no
	auto_accepted = yes
	action_type = neutral
	#potential = {
	#	hidden_trigger = {
	#		from = { is_major = yes }
	#	}
	#}
}

### HRB_NOTE: Rivalries removal ###
# Set any empire as your rival, gains influence but hurts relations. Usable by regular, fallen & awakened empires.
# action_make_rival = {
# 	icon = "GFX_diplomacy_status_rivalry"
# 	auto_accepted = yes
# 	requires_actor_independence = no
# 	requires_recipient_independence = no
# 	should_show_auto_accept_message_recipient = yes
# 	should_notify_all_communications = yes
# 	action_type = aggressive
# 	potential = {
# 		custom_tooltip = grants_humiliation_cb_originator
# 		hidden_trigger = {
# 			OR = {
# 				is_major_major_relation = yes
# 				is_minor_minor_relation = yes
# 			}
# 		}
# 	}
# 	possible = {
# 		# custom_tooltip = {
# 		# 	fail_text = "requires_actor_not_fanatic_purifiers"
# 		# 	OR = {
# 		# 		is_same_species = from
# 		# 		NOT = { has_valid_civic = civic_fanatic_purifiers }
# 		# 	}
# 		# }
# 		# custom_tooltip = {
# 		# 	fail_text = "requires_actor_not_inward_perfection"
# 		# 	NOT = { has_valid_civic = civic_inwards_perfection }
# 		# }
# 		custom_tooltip = {
# 			fail_text = "requires_terrible_opinion_or_supremacist"
# 			OR = {
# 				opinion_level = { who = from level <= terrible }
# 				is_harming_relations_with = from
# 				from = { is_at_war_with = prev }
# 				OR = {
# 					has_policy_flag = "diplo_stance_supremacist"
# 					from = { has_policy_flag = "diplo_stance_supremacist" }
# 				}
# 				from = { is_rival = prev }
# 			}
# 		}
# 	}
# 	on_accept = {
# 		hidden_effect = {
# 			check_casus_belli_valid = {
# 				target = from
# 				type = cb_humiliation
# 			}
# 		}
# 	}
# }
### HRB_NOTE: Rivalries removal ###
# End a rivalry, 10 year cooldown on new rivalries
# action_end_rivalry = {
# 	icon = "GFX_diplomacy_status_rivalry"
# 	auto_accepted = yes
# 	requires_actor_independence = no
# 	requires_recipient_independence = no
# 	should_show_auto_accept_message_recipient = yes
# 	should_notify_all_communications = yes
# 	action_type = positive
# 	potential = {
# 		custom_tooltip = removes_humiliation_cb_originator
# 		hidden_trigger = {
# 			from = { is_major = yes }
# 		}
# 	}
# 	on_accept = {
# 		hidden_effect = {
# 			check_casus_belli_valid = {
# 				target = from
# 				type = cb_humiliation
# 			}
# 		}
# 	}
# }
# Form a defensive pact with another empire that makes you defend them automatically if attacked and vice versa.
# Usable by regular empires only. Not possible while in a federation. Raises trust over time.
action_form_defensive_pact = {
	icon = "GFX_diplomacy_status_defensive_pact"
	requires_actor_peace = yes
	requires_recipient_peace = yes
	diplo_view_acceptance_icon = yes
	should_notify_all_communications = yes
	AI_acceptance_base_value = -50
	action_type = positive
	auto_accepted = no
	potential = {
		hidden_trigger = {
			or = {
				is_country_type = contender
				is_major = yes
			}
			from = {
				or = {
					is_major = yes
					is_country_type = contender
				}
				not = { has_ethic = ethic_fanatic_xenophobe }
				not = { has_ethic = ethic_fanatic_militarist }
				not = { has_ethic = ethic_fanatic_authoritarian }
			}
		}
	}
	possible = {
		# custom_tooltip = {
		# 	fail_text = "requires_actor_not_fanatic_purifiers"
		# 	OR = {
		# 		is_same_species = from
		# 		NOT = { has_valid_civic = civic_fanatic_purifiers }
		# 	}
		# }
		# custom_tooltip = {
		# 	fail_text = "requires_recipient_not_fanatic_purifiers"
		# 	OR = {
		# 		is_same_species = from
		# 		from = { NOT = { has_valid_civic = civic_fanatic_purifiers } }
		# 	}
		# }
		# if = {
		# 	limit = { from = { has_valid_civic = civic_inwards_perfection } }
		# 	if = {
		# 		limit = {
		# 			has_intel = {
		# 				who = from
		# 				intel = civics
		# 			}
		# 		}
		# 		custom_tooltip = {
		# 			fail_text = requires_recipient_not_inward_perfection
		# 			always = no
		# 		}
		# 	}
		# 	else = {
		# 		custom_tooltip = {
		# 			fail_text = diplo_action_no_low_intel
		# 			always = no
		# 		}
		# 	}
		# }
		# custom_tooltip = {
		# 	fail_text = "requires_actor_not_inward_perfection"
		# 	NOT = { has_valid_civic = civic_inwards_perfection }
		# }
		custom_tooltip = {
			fail_text = "requires_excellent_or_better_opinion"
			OR = {
				opinion_level = {
					who = from
					level >= excellent
				}
				is_improving_relations_with = from
			}
		}
	}
	on_accept = {
		add_global_tension = {
			amount = @gt_decrease_tier5
			type = defensive_pact
			country = root
		}
	}
}

# Break an existing defensive pact, harms relations and sets a 20 year truce.
action_break_defensive_pact = {
	icon = "GFX_diplomacy_status_defensive_pact"
	auto_accepted = yes
	requires_actor_peace = yes
	should_notify_all_communications = yes
	should_show_auto_accept_message_recipient = yes
	action_type = negative
	potential = {
		hidden_trigger = {
			or = {
				is_country_type = contender
				is_major = yes
			}
			from = {
				or = {
					is_major = yes
					is_country_type = contender
				}
			}
		}
	}
	proposable = {
		hidden_trigger = {
			if = {
				limit = {
					is_ai = yes
				}
				AND = {
					opinion_level = {
						who = from
						level < excellent
					}
					NOT = {
						is_improving_relations_with = from
					}
				}
			}
		}
	}
	on_accept = {
	}
}

# Form a non-aggression pact with another empire, unable to declare war on each other while it is in effect.
# Usable by regular empires only. Not possible while in a federation. Raises trust over time.
action_form_non_aggression_pact = {
	icon = "GFX_diplomacy_status_non_aggression_pact"
	diplo_view_acceptance_icon = yes
	should_notify_all_communications = yes
	AI_acceptance_base_value = -50
	action_type = positive
	auto_accepted = no
	potential = {
		hidden_trigger = {
			from = {
				or = {
					is_major = yes
					is_country_type = contender
				}
				not = { has_ethic = ethic_fanatic_militarist }
			}
			is_major_major_relation = yes
		}
	}
	possible = {
		# custom_tooltip = {
		# 	fail_text = "requires_actor_not_fanatic_purifiers"
		# 	OR = {
		# 		is_same_species = from
		# 		NOT = { has_valid_civic = civic_fanatic_purifiers	}
		# 	}
		# }
		# custom_tooltip = {
		# 	fail_text = "requires_recipient_not_fanatic_purifiers"
		# 	OR = {
		# 		is_same_species = from
		# 		from = { NOT = { has_valid_civic = civic_fanatic_purifiers } }
		# 	}
		# }
		custom_tooltip = {
			fail_text = "requires_neutral_or_better_opinion"
			OR = {
				opinion_level = {
					who = from
					level >= neutral
				}
				is_improving_relations_with = from
			}
		}
	}
	on_accept = {
		add_global_tension = {
			amount = @gt_decrease_tier5
			type = non_aggression_pact
			country = root
		}
	}
}

# Break an existing non-aggression pact, harms relations and sets a 20 year truce.
action_break_non_aggression_pact = {
	icon = "GFX_diplomacy_status_non_aggression_pact"
	auto_accepted = yes
	should_notify_all_communications = yes
	should_show_auto_accept_message_recipient = yes
	action_type = negative
	potential = {
		hidden_trigger = {
			from = {
				or = {
					is_major = yes
					is_country_type = contender
				}
			}
		}
	}
	proposable = {
		hidden_trigger = {
			if = {
				limit = {
					is_ai = yes
				}
				AND = {
					opinion_level = {
						who = from
						level < neutral
					}
					NOT = {
						is_improving_relations_with = from
					}
				}
			}
		}
	}
	on_accept = {
		add_global_tension = {
			amount = @gt_add_tier4
			type = break_non_aggression_pact
			country = root
		}
	}
}

# Form a commercial pact with another empire, increases value of both trade networks
# Usable by regular empires only. Raises trust over time.
action_form_commercial_pact = {
	icon = "GFX_diplomacy_status_commercial_pact"
	diplo_view_acceptance_icon = yes
	should_notify_all_communications = yes
	requires_actor_independence = no
	AI_acceptance_base_value = -50
	action_type = positive
	auto_accepted = no
	#potential = {
	#	hidden_trigger = {
	#		is_major = yes
	#		from = { is_major = yes }
	#	}
	#}
	possible = {
		custom_tooltip = {
			fail_text = "ACTION_ACTOR_MUST_BE_INDEPENDENT"
			is_subject = no
		}
		custom_tooltip = {
			fail_text = "ACTION_RECIPIENT_MUST_BE_INDEPENDENT"
			FROM = {
				is_subject = no
				not = { has_ethic = ethic_fanatic_xenophobe }
			}
		}
		# custom_tooltip = {
		# 	fail_text = "requires_actor_not_fanatic_purifiers"
		# 	OR = {
		# 		is_same_species = from
		# 		NOT = { has_valid_civic = civic_fanatic_purifiers	}
		# 	}
		# }
		# custom_tooltip = {
		# 	fail_text = "requires_recipient_not_fanatic_purifiers"
		# 	OR = {
		# 		is_same_species = from
		# 		from = { NOT = { has_valid_civic = civic_fanatic_purifiers } }
		# 	}
		# }
		# if = {
		# 	limit = { from = { has_valid_civic = civic_inwards_perfection } }
		# 	if = {
		# 		limit = {
		# 			has_intel = {
		# 				who = from
		# 				intel = civics
		# 			}
		# 		}
		# 		custom_tooltip = {
		# 			fail_text = requires_recipient_not_inward_perfection
		# 			always = no
		# 		}
		# 	}
		# 	else = {
		# 		custom_tooltip = {
		# 			fail_text = diplo_action_no_low_intel
		# 			always = no
		# 		}
		# 	}
		# }
		# custom_tooltip = {
		# 	fail_text = "requires_actor_not_inward_perfection"
		# 	NOT = { has_valid_civic = civic_inwards_perfection }
		# }
		# custom_tooltip = {
		# 	fail_text = "requires_actor_not_gestalt_consciousness"
		# 	is_gestalt = no
		# }
		# custom_tooltip = {
		# 	fail_text = "requires_recipient_not_gestalt_consciousness"
		# 	from = { is_gestalt = no }
		# }
		custom_tooltip = {
			fail_text = "requires_good_or_better_opinion"
			OR = {
				opinion_level = {
					who = from
					level >= good
				}
				is_improving_relations_with = from
			}
		}
	}
}

# Break an existing commercial pact, harms relations and sets a 20 year truce.
action_break_commercial_pact = {
	icon = "GFX_diplomacy_status_commercial_pact"
	auto_accepted = yes
	should_notify_all_communications = yes
	should_show_auto_accept_message_recipient = yes
	action_type = negative
	#potential = {
	#	hidden_trigger = {
	#		is_major = yes
	#		from = { is_major = yes }
	#	}
	#}
	proposable = {
		hidden_trigger = {
			if = {
				limit = {
					is_ai = yes
				}
				AND = {
					opinion_level = {
						who = from
						level < good
					}
					NOT = {
						is_improving_relations_with = from
					}
				}
			}
		}
	}
}

# Form a research agreement with another empire
action_form_research_agreement = {
	icon = "GFX_diplomacy_status_research_agreement"
	diplo_view_acceptance_icon = yes
	should_notify_all_communications = yes
	requires_actor_independence = no
	AI_acceptance_base_value = -50
	action_type = positive
	auto_accepted = no
	#potential = {
	#	hidden_trigger = {
	#		is_major = yes
	#		from = { is_major = yes }
	#	}
	#}
	possible = {
		custom_tooltip = {
			fail_text = "ACTION_ACTOR_MUST_BE_INDEPENDENT"
			is_subject = no
		}
		# custom_tooltip = {
		# 	fail_text = "requires_actor_not_fanatic_purifiers"
		# 	OR = {
		# 		is_same_species = from
		# 		NOT = { has_valid_civic = civic_fanatic_purifiers	}
		# 	}
		# }
		# custom_tooltip = {
		# 	fail_text = "requires_recipient_not_fanatic_purifiers"
		# 	OR = {
		# 		is_same_species = from
		# 		from = { NOT = { has_valid_civic = civic_fanatic_purifiers } }
		# 	}
		# }
		# if = {
		# 	limit = { from = { has_valid_civic = civic_inwards_perfection } }
		# 	if = {
		# 		limit = {
		# 			has_intel = {
		# 				who = from
		# 				intel = civics
		# 			}
		# 		}
		# 		custom_tooltip = {
		# 			fail_text = requires_recipient_not_inward_perfection
		# 			always = no
		# 		}
		# 	}
		# 	else = {
		# 		custom_tooltip = {
		# 			fail_text = diplo_action_no_low_intel
		# 			always = no
		# 		}
		# 	}
		# }
		# custom_tooltip = {
		# 	fail_text = "requires_actor_not_inward_perfection"
		# 	NOT = { has_valid_civic = civic_inwards_perfection }
		# }
		custom_tooltip = {
			fail_text = "requires_good_or_better_opinion"
			OR = {
				opinion_level = {
					who = from
					level >= good
				}
				is_improving_relations_with = from
			}
		}
	}
	on_accept = {
		add_global_tension = {
			amount = @gt_decrease_tier3
			type = research_agreement
			country = root
		}
	}
}

# Break an existing research agreement.
action_break_research_agreement = {
	icon = "GFX_diplomacy_status_research_agreement"
	auto_accepted = yes
	should_notify_all_communications = yes
	should_show_auto_accept_message_recipient = yes
	action_type = negative
	#potential = {
	#	hidden_trigger = {
	#		is_major = yes
	#		from = { is_major = yes }
	#	}
	#}
	proposable = {
		hidden_trigger = {
			if = {
				limit = {
					is_ai = yes
				}
				AND = {
					opinion_level = {
						who = from
						level < good
					}
					NOT = {
						is_improving_relations_with = from
					}
				}
			}
		}
	}
}

# Guarantee another empire, makes you defend them automatically if attacked.
# Usable by regular empires only. Not possible while in a federation. Raises trust over time.
action_guarantee_independence = {
	icon = "GFX_diplomacy_status_guarantee"
	auto_accepted = no
	diplo_view_acceptance_icon = yes
	should_show_auto_accept_message_recipient = no
	should_notify_all_communications = yes
	requires_recipient_independence = yes
	requires_actor_independence = yes
	action_type = positive
	potential = {
		# Cannot guarantee if you are in an alliance
		hidden_trigger = {
			NOT = {
				exists = alliance
			}
		}
		# Cannot guarantee if they are in an alliance
		hidden_trigger = {
			exists = from
			from = {
				NOT = {
					exists = alliance
				}
			}
		}
		# Already guaranteeing
		hidden_trigger = {
			exists = from
			NOT = {
				is_guaranteeing = from
			}
		}
		# Defensive Pact
		hidden_trigger = {
			exists = from
			NOT = {
				has_defensive_pact = from
			}
		}
		# Majors To Minors
		hidden_trigger = {
			is_major = yes
			from = {
				is_minor = yes
			}
		}

		custom_tooltip = TT_GUARANTEE_INDEPENDENCE
	}
	possible = {
		# custom_tooltip = {
		# 	fail_text = "requires_actor_not_fanatic_purifiers"
		# 	OR = {
		# 		is_same_species = from
		# 		NOT = { has_valid_civic = civic_fanatic_purifiers	}
		# 	}
		# }
		# custom_tooltip = {
		# 	fail_text = "requires_recipient_not_fanatic_purifiers"
		# 	OR = {
		# 		is_same_species = from
		# 		from = { NOT = { has_valid_civic = civic_fanatic_purifiers } }
		# 	}
		# }
		# custom_tooltip = {
		# 	fail_text = "requires_actor_not_inward_perfection"
		# 	NOT = { has_valid_civic = civic_inwards_perfection }
		# }
		custom_tooltip = {
			fail_text = "requires_neutral_or_better_opinion"
			OR = {
				opinion_level = {
					who = from
					level >= neutral
				}
				is_improving_relations_with = from
			}
		}
	}
}

# Break an existing guarantee, harms relations and sets a 20 year truce.
action_break_guarantee = {
	icon = "GFX_diplomacy_status_guarantee"
	auto_accepted = yes
	should_notify_all_communications = yes
	should_show_auto_accept_message_recipient = yes
	requires_recipient_independence = no
	action_type = negative
	#potential = {
	#	hidden_trigger = {
	#		from = { is_major = yes }
	#	}
	#}
	possible = {
		is_guaranteeing = from
	}
	proposable = {
		hidden_trigger = {
			if = {
				limit = {
					is_ai = yes
				}
				AND = {
					opinion_level = {
						who = from
						level < neutral
					}
					NOT = {
						is_improving_relations_with = from
					}
				}
			}
		}
	}
}

# Support independence of a subject, makes you help them if they declare an independence war.
# Usable by regular empires only. Not possible while in a federation. Raises trust over time.
action_support_independence = {
	icon = "GFX_diplomacy_status_support_independence"
	is_listed = yes
	auto_accepted = yes
	should_notify_all_communications = yes
	requires_recipient_independence = no
	action_type = positive
	potential = {
		hidden_trigger = {
			exists = from
			from = {
				is_subject = yes
			}
			NOT = {
				root = {
					is_overlord_to = from
				}
			}
		}
		hidden_trigger = {
			from = {
				is_minor = yes
			}
		}
		hidden_trigger = {
			root = {
				is_major = yes
			}
		}
	}
	possible = {
		# custom_tooltip = {
		# 	fail_text = "requires_actor_not_fanatic_purifiers"
		# 	OR = {
		# 		is_same_species = from
		# 		NOT = { has_valid_civic = civic_fanatic_purifiers	}
		# 	}
		# }
		# custom_tooltip = {
		# 	fail_text = "requires_recipient_not_fanatic_purifiers"
		# 	OR = {
		# 		is_same_species = from
		# 		from = { NOT = { has_valid_civic = civic_fanatic_purifiers } }
		# 	}
		# }
		# custom_tooltip = {
		# 	fail_text = "requires_actor_not_inward_perfection"
		# 	NOT = { has_valid_civic = civic_inwards_perfection }
		# }
	}
	proposable = {
	}
}

# Break an existing support independence, harms relations.
action_break_support = {
	icon = "GFX_diplomacy_status_support_independence"
	auto_accepted = yes
	should_notify_all_communications = yes
	should_show_auto_accept_message_recipient = yes
	requires_recipient_independence = no
	action_type = negative
	potential = {
		hidden_trigger = {
			exists = from
			from = {
				is_subject = yes
			}
			NOT = {
				root = {
					is_overlord_to = from
				}
			}
		}
		hidden_trigger = {
			from = {
				is_minor = yes
			}
		}
		hidden_trigger = {
			root = {
				is_major = yes
			}
		}
	}
	possible = {
	}
	proposable = {
		hidden_trigger = {
			if = {
				limit = {
					is_ai = yes
				}
				resource_income_compare = {
					resource = influence
					value < 1
				}
				opinion_level = {
					who = from
					level < poor
				}
			}
		}
	}
}

# Creates a migration treaty that allows pops to move freely between two empires. Only possible if both empires have suitable worlds for each others' pops.
# Usable by regular empires only. Raises trust over time.
action_form_migration_pact = {
	icon = "GFX_diplomacy_status_migration_pact"
	diplo_view_acceptance_icon = yes
	should_notify_all_communications = yes
	requires_actor_independence = no
	requires_recipient_independence = no
	AI_acceptance_base_value = -50
	action_type = positive
	auto_accepted = no
	potential = {
		hidden_trigger = {
			not = { has_ethic = ethic_xenophobe }
			not = { has_ethic = ethic_fanatic_xenophobe }					
			from = {
				or = {
					is_major = yes
					is_country_type = contender
				}
				not = { has_ethic = ethic_fanatic_xenophobe }
				not = { has_ethic = ethic_xenophobe }
			}
		}
	}
	possible = {
		# custom_tooltip = {
		# 	fail_text = "requires_actor_not_fanatic_purifiers"
		# 	OR = {
		# 		is_same_species = from
		# 		NOT = { has_valid_civic = civic_fanatic_purifiers	}
		# 	}
		# }
		# custom_tooltip = {
		# 	fail_text = "requires_recipient_not_fanatic_purifiers"
		# 	OR = {
		# 		is_same_species = from
		# 		from = { NOT = { has_valid_civic = civic_fanatic_purifiers } }
		# 	}
		# }
		# custom_tooltip = {
		# 	fail_text = "requires_actor_not_gestalt_consciousness"
		# 	NOT = { has_ethic = ethic_gestalt_consciousness	}
		# }
		# custom_tooltip = {
		# 	fail_text = "requires_recipient_not_gestalt_consciousness"
		# 	from = { NOT = { has_ethic = ethic_gestalt_consciousness } }
		# }
		# if = {
		# 	limit = { from = { has_valid_civic = civic_inwards_perfection } }
		# 	if = {
		# 		limit = {
		# 			has_intel = {
		# 				who = from
		# 				intel = civics
		# 			}
		# 		}
		# 		custom_tooltip = {
		# 			fail_text = requires_recipient_not_inward_perfection
		# 			always = no
		# 		}
		# 	}
		# 	else = {
		# 		custom_tooltip = {
		# 			fail_text = diplo_action_no_low_intel
		# 			always = no
		# 		}
		# 	}
		# }
		# custom_tooltip = {
		# 	fail_text = "requires_actor_not_inward_perfection"
		# 	NOT = { has_valid_civic = civic_inwards_perfection }
		# }
		# if = {
		# 	limit = { from = { has_valid_civic = civic_barbaric_despoilers } }
		# 	if = {
		# 		limit = {
		# 			has_intel = {
		# 				who = from
		# 				intel = civics
		# 			}
		# 		}
		# 		custom_tooltip = {
		# 			fail_text = requires_recipient_not_barbaric_despoilers
		# 			always = no
		# 		}
		# 	}
		# 	else = {
		# 		custom_tooltip = {
		# 			fail_text = diplo_action_no_low_intel
		# 			always = no
		# 		}
		# 	}
		# }
		# custom_tooltip = {
		# 	fail_text = "requires_actor_not_barbaric_despoilers"
		# 	NOT = { has_valid_civic = civic_barbaric_despoilers }
		# }
		custom_tooltip = {
			fail_text = "requires_good_or_better_opinion"
			OR = {
				opinion_level = {
					who = from
					level >= good
				}
				is_improving_relations_with = from
			}
		}
	}
	on_accept = {
		add_global_tension = {
			amount = @gt_decrease_tier2
			type = migration_pact
			country = root
		}
	}
}

# Break an existing migration pact, harms relations.
action_break_migration_pact = {
	icon = "GFX_diplomacy_status_migration_pact"
	auto_accepted = yes
	should_notify_all_communications = yes
	should_show_auto_accept_message_recipient = yes
	requires_actor_independence = no
	requires_recipient_independence = no
	action_type = negative
	potential = {
		# hidden_trigger = {
		# 	from = {
		 		#is_major = yes
		# 	}
		# }
	}
	proposable = {
		hidden_trigger = {
			if = {
				limit = {
					is_ai = yes
				}
				AND = {
					opinion_level = {
						who = from
						level < good
					}
					not = {
						is_improving_relations_with = from
					}
				}
			}
		}
	}
}

# Open borders towards another empire, allowing their ships to traverse your territory. Usable by and against regular empires only.
action_open_borders = {
	icon = "GFX_diplomacy_status_open_borders"
	auto_accepted = yes
	requires_actor_independence = no
	requires_recipient_independence = no
	should_show_auto_accept_message_recipient = yes
	#should_notify_all_communications = yes
	action_type = positive
	# HRB-TODO: Need to check IsProposable() logic in code. If the Target has closed borders the Actor AI will never open their borders 
	# potential = {
	# }
	# possible = {
	# 	hidden_trigger = {
	# 		has_closed_borders = from
	# 		if = {
	# 			limit = {
	# 				is_ai = yes
	# 			}
	# 			opinion_level = {
	# 				who = from
	# 				level >= neutral
	# 			}
	# 		}
	# 	}
	# }
	# proposable = {
	# }
}

# Close borders towards another empire, blocking their ships from entering your territory. Usable by and against regular empires only. Harms relations.
action_close_borders = {
	icon = "GFX_diplomacy_status_closed_borders"
	auto_accepted = yes
	requires_actor_independence = no
	requires_recipient_independence = no
	should_show_auto_accept_message_recipient = yes
	#should_notify_all_communications = yes
	action_type = negative
	potential = {
		hidden_trigger = {
			NOT = {
				has_closed_borders = from
			}
		}
	}
	possible = {
		can_control_access_for = from
		if = {
			limit = {
				is_ai = yes
			}
			opinion_level = {
				who = from
				level < neutral
			}
		}
	}
}

# Release a subject of any type. Hurts relations and sets a 20 year truce.
action_release_subject = {
	icon = "GFX_diplomacy_status_has_vassal"
	requires_recipient_independence = no
	auto_accepted = yes
	should_notify_all_communications = yes
	should_show_auto_accept_message_recipient = yes
	action_type = positive
	potential = {
		hidden_trigger = {
			is_major_minor_relation = yes
		}
	}
}

# Ask to be released as subject of any type (overlord must accept). Hurts relations and sets a 20 year truce.
action_ask_to_be_released_subject = {
	icon = "GFX_diplomacy_status_has_vassal"
	requires_actor_independence = no
	diplo_view_acceptance_icon = yes
	should_notify_all_communications = yes
	AI_acceptance_base_value = -50
	action_type = neutral
	potential = {
		hidden_trigger = {
			from = {
				is_major = yes
			}
		}
	}
}

# Liberate Subject. Starts a war against the Subject Overlord.
action_liberate_subject = {
	icon = "GFX_diplomacy_status_has_vassal"
	requires_recipient_independence = no
	diplo_view_acceptance_icon = yes
	should_notify_all_communications = yes
	action_type = neutral
	auto_accepted = yes
	potential = {
		hidden_trigger = {
			is_major_minor_relation = yes
		}
	}
}

# Request the release of a Subject Minor Power.
action_request_subject_liberation = {
	icon = "GFX_diplomacy_status_has_vassal"
	requires_actor_independence = no
	diplo_view_acceptance_icon = yes
	should_notify_all_communications = yes
	action_type = neutral
	auto_accepted = no
	ai_acceptance_base_value = -50
	potential = {
		hidden_trigger = {
			is_major_major_relation = yes
		}
	}
	possible = {
		from = { is_overlord = yes  }

		custom_tooltip_fail = {
			text = "request_liberation_cooldown"
			not = {
				has_country_flag = requested_@from
			}
		}
	}

	on_accept = {

		if = {
			limit = {
				has_country_id = ufop
				prev = {
					has_country_flag = bajoran
				}
			}
			set_country_flag = bajoran_liberated_by_ufop
		}
	}

	on_decline = {

		every_country = {
			limit = {
				is_major = yes
				not = {
					is_country = from
				}
			}

			add_opinion_modifier = {
				who = from
				modifier = opinion_declined_liberation
			}

			set_country_flag = liberation_war_vs_@from

		}

		add_global_tension = { 
			amount = @gt_add_tier2
			type = declined_liberation
			country = from
		}

		set_timed_country_flag = {
			flag = requested_@from
			days = @request_liberation_cooldown
		}

		set_variable = {
			which = request_liberation_cooldown_days
			value = @request_liberation_cooldown
		}	

	}
}

# Send an insult. Harms relations.
action_insult = {
	icon = "GFX_diplomacy_status_war"
	requires_recipient_independence = no
	requires_actor_independence = no
	auto_accepted = yes
	should_show_auto_accept_message_recipient = yes
	action_type = aggressive
	potential = {
		hidden_trigger = {
			is_major_minor_relation = yes
		}
	}
	possible = {
		custom_tooltip = {
			fail_text = "requires_poor_or_worse_opinion"
			OR = {
				opinion_level = {
					who = from
					level <= poor
				}
				is_harming_relations_with = from
				from = {
					is_at_war_with = prev
				}
			}
		}
	}
}

# Annex a subject of a type that permits annexation. Costs influence and takes time based on the size of the subject.
action_integrate_subject = {
	icon = "GFX_diplomacy_status_being_integrated"
	auto_accepted = yes
	requires_recipient_independence = no
	should_notify_all_communications = yes
	action_type = neutral
	potential = {
		hidden_trigger = {
			from = {
				is_major = yes
			}
		}
	}
}

# Cancel an ongoing integration.
action_cancel_subject_integration = {
	icon = "GFX_diplomacy_status_being_integrated"
	auto_accepted = yes
	requires_recipient_independence = no
	should_notify_all_communications = yes
	action_type = neutral
	potential = {
		hidden_trigger = {
			from = {
				is_major = yes
			}
		}
	}
}

action_ask_to_join_galactic_empire = {
	icon = "GFX_diplomacy_status_join_galactic_empire"
	auto_accepted = no
	should_notify_all_communications = yes
	action_type = neutral
	potential = {
		hidden_trigger = {
			from = {
				is_major = yes
			}
		}
	}
}

action_add_imperial_council_member = {
	icon = "GFX_diplomacy_status_add_imperial_council_member"
	auto_accepted = yes
	requires_recipient_independence = no
	should_notify_all_communications = yes
	action_type = positive
	potential = {
		hidden_trigger = {
			from = {
				is_major = yes
			}
		}
	}
	on_accept = {
		hidden_effect = {
			from = {
				add_permanent_councillor = yes
				add_opinion_modifier = {
					who = root
					modifier = opinion_emperor_gave_council_seat
				}
			}
		}
	}
}

action_remove_imperial_council_member = {
	icon = "GFX_diplomacy_status_remove_imperial_council_member"
	auto_accepted = yes
	requires_recipient_independence = no
	should_notify_all_communications = yes
	action_type = negative
	potential = {
		hidden_trigger = {
			from = {
				is_major = yes
			}
		}
	}
	on_accept = {
		hidden_effect = {
			from = {
				add_opinion_modifier = {
					who = root
					modifier = opinion_emperor_removed_council_seat
				}
			}
		}
	}
}

# Create embassies in both of your capitals. Affects intel and improve relations
action_embassy = {
	icon = "GFX_embassy_our"
	auto_accepted = no
	diplo_view_acceptance_icon = yes
	requires_recipient_independence = no
	requires_actor_independence = no
	should_notify_all_communications = no
	action_type = positive
	potential = {
		hidden_trigger = {
			from = {
				or = {
					is_major = yes
					is_country_type = contender
				}
			}
		}
	}
	possible = {
		custom_tooltip = {
			fail_text = "DIPLOMACY_STATUS_WAR"
			NOT = {
				is_at_war_with = from
			}
		}
		### HRB_NOTE: Rivalries removal ###
		# custom_tooltip = {
		# 	fail_text = "HAS_RIVALRY"
		# 	NOR = {
		# 		is_rival = from
		# 		from = { is_rival = prev }
		# 	}
		# }
	}
}

action_recall_embassy = {
	icon = "GFX_embassy_our"
	auto_accepted = yes
	requires_recipient_independence = no
	requires_actor_independence = no
	should_notify_all_communications = no
	action_type = negative
	potential = {
		hidden_trigger = {
			from = {
				or = {
					is_major = yes
					is_country_type = contender
				}
			}
		}
	}
}
